<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>InfList</title>
        <!----- jquery ----->
        <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
        <!-- bootstrap -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
        <!-- animate.css -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
        <!-- font -->
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Teko:wght@300&display=swap" rel="stylesheet">
        <!-- Black Hans Sans-->
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&display=swap" rel="stylesheet">
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300&display=swap" rel="stylesheet">
        <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
        
        <style>
            header {
                width: 60vw;
                height: 5vh;
                margin-bottom: 3vh;
            }

            body {
                width: 100vw;
                margin-top: 3vh;

                color : black;
                font-family: 'Noto Sans KR', sans-serif;

            }

            .row_top {
                width: 100%;
                margin-left: 20vw;
            }

            .row_content_box {
                margin-left: 10vw;
                height: 70vh;
            }

            .row_content {
                height: 15vh;
            }

            .container_search {
                padding: 0 auto;
                vertical-align: middle;
                white-space: nowrap;
            }

            .search_bar {
                background-color: white;
                border: 3px solid #596fff;
                border-right: none;
                padding: 1vh 0;
                border-radius: 5px 0 0 5px;
                outline: none;
                width: 40vw;
            }

            .lens {
                width: 2vw;
                height: 5.9vh;
                border: 1px solid #596fff;
                background-color: #596fff;
                text-align: center;
                color: #fff;
                border-radius: 0 5px 5px 0;
                cursor: pointer;
            }

            .box {
                width: 5vw;
                height: 5vw;
                border-radius: 70%;
                overflow: hidden;
            }

            .icon {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }

            #sec_result {
                margin-left: 10vw;
                width: 80vw;
                height: 75vh;
            }

            #div_output {

            }
        </style>

        <script>
            $(document).ready(function() {
                function getKeywordInfo() {
                    var kw = $("#input_search").val();
                    $("#div_output").empty();
                    if (!kw) {
                        alert('키워드를 입력해주세요');
                    } else {
                        $.ajax({
                            url: "/keyword",
                            async: true,
                            type: "POST",
                            data: {
                                keyword: kw
                            },
                            dataType: "JSON",
                            success : function(jsonData) {
                                
                                $(jsonData).each(function (index, item) {
                                    var output = '';
                                    output += '<div class="row row_content">'
                                    $('#output').append(output);
                                    $.ajax({
                                        type : "GET",
                                        dataType : "JSON",
                                        url : `https://www.googleapis.com/youtube/v3/channels?id=${item.yt_url.substring(9)}&part=snippet&key=AIzaSyDmrf3DxFShAiFtvapwqOtn_HMBgciQqqk`,
                                        async: false,
                                        contentType : "application/json",
                                        success : function(jd) {
                                            var items = jd.items[0];
                                            // console.log(items)
                                            output += `  <div class="col-md-1" style="height:100%; padding: 6vh 0px;">`;
                                            output += `  <h4 style="text-align:center; margin: 0 auto;">${index+1}</h4>`;
                                            output += `  </div>`;
                                            output += '  <div class="col-md-4" style="height:100%; padding: 2.5vh 0px;">';
                                            output += '    <div class="box">';
                                            output += `      <img class="icon" src="${items.snippet.thumbnails.medium.url}" />`;
                                            output += '    </div>';
                                            output += '  </div>';

                                            $.ajax({
                                                type : "GET",
                                                dataType : "JSON",
                                                url : `https://www.googleapis.com/youtube/v3/channels?id=${item.yt_url.substring(9)}&part=statistics&key=AIzaSyDmrf3DxFShAiFtvapwqOtn_HMBgciQqqk`,
                                                async: false,
                                                contentType : "application/json",
                                                success : function(jsd) {
                                                    var it = jsd.items[0].statistics;
                                                    console.log(it);
                                                    output += `  <div class="col-md-3">`;
                                                    output += `     <h6 style="text-align:center; margin: 0 auto;">${it.subscriberCount}</h6>`;
                                                    output += `  </div>`;
                                                    output += '  <div class="col-md-4">';
                                                    output += `     <h6 style="text-align:center; margin: 0 auto;">${it.viewCount}</h6>`;
                                                    output += '  </div>';
                                                    output += '</div>';
                                                    

                                                    $('#div_output').append(output);
                                                }
                                            })
                                            //$('#div_output').append(output);
                                        },
                                        complete : function(data) {
                           
                                        },
                                        error : function(xhr, status, error) {
                                            console.log("유튜브 요청 에러: "+ error);
                                        }
                                   });
                                })


                            },
                        });
                    }
                
                }
                // event binding
                $("#logo").on("click", function() {
                    location.href="/"; 
                })
                $("#btn_search").on("click", function(){
                    getKeywordInfo();
                });
                $("#input_search").on("keyup", function(e) {
                    if (e.keyCode == 13) getKeywordInfo();
                })
            });
        </script>
    </head>
    <body id="body">
        <header>
            <div class="row row_top">
                <div class="col-md-4">
                    <img id="logo" style="height: 5vh; margin: 0 auto; cursor:pointer;" src="img/logo_main.png">
                </div>
                <div class="col-md-8 text-right container_search">
                    <input id="input_search" style="text-indent: 1em; width: 80%; display: inline-block;" class="form-control" type="text" placeholder="키워드로 검색 가능합니다." /><button id="btn_search" type="submit" class="btn btn-primary"><i class="fa fa-search"></i></button>
                </div>
            </div>
        </header>
        <hr>
        <section id="sec_result">
            <hr style="background-color: black !important; height:0.1vh;">
            <div id="div_output" class="row row_content_box" style="width:60vw;">
            </div>
        </section>
    </body>
</html>